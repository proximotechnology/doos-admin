<!DOCTYPE html>
<html lang="ar" dir="rtl">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    </head>
    <body class="bg-gray-50 dark:bg-gray-900">
        <!-- Breadcrumb -->
        <nav class="mb-6 flex items-center space-x-2 rtl:space-x-reverse" aria-label="Breadcrumb">
            <ol class="flex items-center space-x-2 rtl:space-x-reverse">
                <li>
                    <a href="javascript:;" class="flex items-center text-sm font-medium text-primary transition-colors hover:text-primary/80">
                        <svg class="mr-2 h-4 w-4 rtl:ml-2 rtl:mr-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                        </svg>
                        <span x-text="$store.i18n.t('dashboard')"></span>
                    </a>
                </li>
                <li>
                    <div class="flex items-center">
                        <svg class="h-4 w-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="ml-2 text-sm font-medium text-gray-500 dark:text-gray-400 rtl:mr-2 rtl:ml-0" x-text="$store.i18n.t('plan_subscriptions')"></span>
                    </div>
                </li>
                <li aria-current="page">
                    <div class="flex items-center">
                        <svg class="h-4 w-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="ml-2 text-sm font-medium text-gray-900 dark:text-white rtl:mr-2 rtl:ml-0" x-text="$store.i18n.t('subscribe')"></span>
                    </div>
                </li>
            </ol>
        </nav>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="fixed inset-0 z-50 flex hidden items-center justify-center bg-gray-900 bg-opacity-50 backdrop-blur-sm">
            <div class="flex flex-col items-center rounded-xl bg-white p-8 shadow-2xl dark:bg-gray-800">
                <div class="mb-4 h-16 w-16 animate-spin rounded-full border-4 border-primary/20 border-t-primary"></div>
                <p class="text-lg font-medium text-gray-700 dark:text-gray-300" x-text="$store.i18n.t('loading_data')"></p>
            </div>
        </div>

        <div x-data="subscriptionsTable">
            <!-- Filters Panel -->
            <div class="panel mb-6 overflow-hidden border-2 border-primary/20 shadow-lg">
                <div class="bg-gradient-to-r from-primary/10 via-primary/5 to-transparent px-6 py-4 dark:from-primary/20 dark:via-primary/10">
                    <div class="flex items-center gap-3">
                        <div class="flex h-10 w-10 items-center justify-center rounded-lg bg-primary/20 text-primary">
                            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
                            </svg>
                        </div>
                        <div>
                            <h5 class="text-lg font-bold text-gray-900 dark:text-white" x-text="$store.i18n.t('filters')"></h5>
                            <p class="text-xs text-gray-500 dark:text-gray-400" x-text="$store.i18n.t('filter_subscriptions') || 'Filter subscriptions'"></p>
                        </div>
                    </div>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-5">
                        <div>
                            <label class="mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300" x-text="$store.i18n.t('status')"></label>
                            <select x-model="filters.status" @change="fetchSubscriptions()" class="form-select w-full rounded-lg border-gray-300 bg-white shadow-sm transition-all focus:border-primary focus:ring-2 focus:ring-primary/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white">
                                <option value="" x-text="$store.i18n.t('all_statuses')"></option>
                                <option value="active" x-text="$store.i18n.t('active')"></option>
                                <option value="pending" x-text="$store.i18n.t('pending')"></option>
                                <option value="finished" x-text="$store.i18n.t('finished')"></option>
                            </select>
                        </div>

                        <div>
                            <label class="mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300" x-text="$store.i18n.t('user')"></label>
                            <select x-model="filters.user_id" @change="fetchSubscriptions()" class="form-select w-full rounded-lg border-gray-300 bg-white shadow-sm transition-all focus:border-primary focus:ring-2 focus:ring-primary/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white">
                                <option value="" x-text="$store.i18n.t('all_users')"></option>
                                <template x-for="user in users" :key="user.id">
                                    <option :value="user.id" x-text="user.name"></option>
                                </template>
                            </select>
                        </div>

                        <div>
                            <label class="mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300" x-text="$store.i18n.t('plan')"></label>
                            <select x-model="filters.plan_id" @change="fetchSubscriptions()" class="form-select w-full rounded-lg border-gray-300 bg-white shadow-sm transition-all focus:border-primary focus:ring-2 focus:ring-primary/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white">
                                <option value="" x-text="$store.i18n.t('all_plans')"></option>
                                <template x-for="plan in plans" :key="plan.id">
                                    <option :value="plan.id" x-text="plan.name"></option>
                                </template>
                            </select>
                        </div>

                        <div>
                            <label class="mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300" x-text="$store.i18n.t('start_date')"></label>
                            <input
                                type="date"
                                x-model="filters.start_date"
                                @change="fetchSubscriptions()"
                                class="form-input w-full rounded-lg border-gray-300 bg-white shadow-sm transition-all focus:border-primary focus:ring-2 focus:ring-primary/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
                            />
                        </div>

                        <div>
                            <label class="mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300" x-text="$store.i18n.t('end_date')"></label>
                            <input
                                type="date"
                                x-model="filters.end_date"
                                @change="fetchSubscriptions()"
                                class="form-input w-full rounded-lg border-gray-300 bg-white shadow-sm transition-all focus:border-primary focus:ring-2 focus:ring-primary/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
                            />
                        </div>
                    </div>
                </div>
            </div>

            <!-- Subscriptions Table Panel -->
            <div class="panel overflow-hidden border-2 border-primary/20 shadow-lg">
                <div class="mb-5 flex flex-wrap items-center justify-between gap-4 bg-gradient-to-r from-primary/10 via-primary/5 to-transparent px-6 py-4 dark:from-primary/20 dark:via-primary/10">
                    <div class="flex items-center gap-3">
                        <div class="flex h-10 w-10 items-center justify-center rounded-lg bg-primary/20 text-primary">
                            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <div>
                            <h5 class="text-lg font-bold text-gray-900 dark:text-white" x-text="$store.i18n.t('subscriptions_management')"></h5>
                            <p class="text-xs text-gray-500 dark:text-gray-400" x-text="$store.i18n.t('manage_user_subscriptions') || 'Manage user subscriptions'"></p>
                        </div>
                    </div>
                    <div class="flex flex-wrap items-center gap-2" x-show="hasSubscriptions()">
                        <span class="inline-flex items-center rounded-full bg-primary/10 px-3 py-1 text-xs font-medium text-primary dark:bg-primary/20 dark:text-primary" x-text="$store.i18n.t('total') + ': ' + (subscriptions?.total || 0)"></span>
                        <span class="inline-flex items-center rounded-full bg-green-100 px-3 py-1 text-xs font-medium text-green-800 dark:bg-green-900/30 dark:text-green-300" x-text="$store.i18n.t('active') + ': ' + (getStatusCount('active') || 0)"></span>
                        <span class="inline-flex items-center rounded-full bg-yellow-100 px-3 py-1 text-xs font-medium text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300" x-text="$store.i18n.t('pending') + ': ' + (getStatusCount('pending') || 0)"></span>
                        <span class="inline-flex items-center rounded-full bg-red-100 px-3 py-1 text-xs font-medium text-red-800 dark:bg-red-900/30 dark:text-red-300" x-text="$store.i18n.t('finished') + ': ' + (getStatusCount('finished') || 0)"></span>
                    </div>
                </div>

                <div class="p-6">
                    <!-- Loading State -->
                    <div id="tableLoading" class="flex hidden items-center justify-center py-12">
                        <div class="flex flex-col items-center">
                            <div class="mb-4 h-12 w-12 animate-spin rounded-full border-4 border-primary/20 border-t-primary"></div>
                            <span class="text-sm font-medium text-gray-600 dark:text-gray-400" x-text="$store.i18n.t('loading_data')"></span>
                        </div>
                    </div>

                    <!-- Table Container -->
                    <div class="table-responsive overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-700" x-show="!isLoading && hasSubscriptions()">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-700">
                                <tr>
                                    <th scope="col" class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 dark:text-gray-300">
                                        #
                                    </th>
                                    <th scope="col" class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 dark:text-gray-300">
                                        <span x-text="$store.i18n.t('user')"></span>
                                    </th>
                                    <th scope="col" class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 dark:text-gray-300">
                                        <span x-text="$store.i18n.t('plan')"></span>
                                    </th>
                                    <th scope="col" class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 dark:text-gray-300">
                                        <span x-text="$store.i18n.t('status')"></span>
                                    </th>
                                    <th scope="col" class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 dark:text-gray-300">
                                        <span x-text="$store.i18n.t('start_date')"></span>
                                    </th>
                                    <th scope="col" class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 dark:text-gray-300">
                                        <span x-text="$store.i18n.t('end_date')"></span>
                                    </th>
                                    <th scope="col" class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 dark:text-gray-300">
                                        <span x-text="$store.i18n.t('price')"></span>
                                    </th>
                                    <th scope="col" class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 dark:text-gray-300">
                                        <span x-text="$store.i18n.t('cars_limit')"></span>
                                    </th>
                                    <th scope="col" class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 dark:text-gray-300">
                                        <span x-text="$store.i18n.t('remaining_cars')"></span>
                                    </th>
                                    <th scope="col" class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 dark:text-gray-300">
                                        <span x-text="$store.i18n.t('payment')"></span>
                                    </th>
                                    <th scope="col" class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-700 dark:text-gray-300">
                                        <span x-text="$store.i18n.t('renewal_data')"></span>
                                    </th>
                                    <th scope="col" class="px-6 py-4 text-center text-xs font-bold uppercase tracking-wider text-gray-700 dark:text-gray-300">
                                        <span x-text="$store.i18n.t('action')"></span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-gray-800">
                                <template x-for="(subscription, index) in subscriptions.data" :key="subscription.id">
                                    <tr class="transition-colors hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                        <td class="whitespace-nowrap px-6 py-4 text-sm font-medium text-gray-900 dark:text-gray-100" x-text="index + 1 + (subscriptions.current_page - 1) * subscriptions.per_page"></td>
                                        <td class="whitespace-nowrap px-6 py-4">
                                            <div class="flex flex-col">
                                                <span x-text="subscription.user?.name || 'N/A'" class="text-sm font-semibold text-gray-900 dark:text-white"></span>
                                                <span x-text="subscription.user?.email || ''" class="text-xs text-gray-500 dark:text-gray-400"></span>
                                                <div class="mt-1 flex flex-wrap items-center gap-2 text-xs text-gray-500 dark:text-gray-400">
                                                    <template x-if="subscription.user?.phone">
                                                        <div class="flex items-center gap-1">
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                                                            </svg>
                                                            <span x-text="subscription.user.phone"></span>
                                                        </div>
                                                    </template>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="whitespace-nowrap px-6 py-4">
                                            <span class="text-sm font-medium text-gray-900 dark:text-white" x-text="subscription.plan?.name || 'N/A'"></span>
                                        </td>
                                        <td class="whitespace-nowrap px-6 py-4">
                                            <span
                                                :class="{
                                                    'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300': subscription.status === 'active',
                                                    'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300': subscription.status === 'pending',
                                                    'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300': subscription.status === 'finished'
                                                }"
                                                class="inline-flex rounded-full px-3 py-1 text-xs font-semibold capitalize leading-5"
                                                x-text="subscription.status === 'active' ? $store.i18n.t('active') : subscription.status === 'pending' ? $store.i18n.t('pending') : $store.i18n.t('finished')"
                                            ></span>
                                        </td>
                                        <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-900 dark:text-gray-100" x-text="formatDate(subscription.date_from)"></td>
                                        <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-900 dark:text-gray-100" x-text="formatDate(subscription.date_end)"></td>
                                        <td class="whitespace-nowrap px-6 py-4">
                                            <span class="text-sm font-semibold text-gray-900 dark:text-white" x-text="'$' + (subscription.price || 0)"></span>
                                        </td>
                                        <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-900 dark:text-gray-100" x-text="subscription.car_limite || 0"></td>
                                        <td class="whitespace-nowrap px-6 py-4">
                                            <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium" 
                                                :class="{
                                                    'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300': subscription.remaining_cars > 0,
                                                    'bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-300': subscription.remaining_cars === 0
                                                }"
                                                x-text="subscription.remaining_cars || 0"></span>
                                        </td>
                                        <td class="whitespace-nowrap px-6 py-4">
                                            <span
                                                :class="{
                                                    'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300': subscription.is_paid === '1' || subscription.is_paid === 1,
                                                    'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300': subscription.is_paid === '0' || subscription.is_paid === 0
                                                }"
                                                class="inline-flex rounded-full px-3 py-1 text-xs font-semibold leading-5"
                                                x-text="subscription.is_paid === '1' || subscription.is_paid === 1 ? $store.i18n.t('paid') : $store.i18n.t('unpaid')"
                                            ></span>
                                        </td>
                                        <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-900 dark:text-gray-100">
                                            <template x-if="subscription.renewal_data">
                                                <span class="font-medium" x-text="subscription.renewal_data"></span>
                                            </template>
                                            <template x-if="!subscription.renewal_data">
                                                <span class="text-gray-400 dark:text-gray-500">-</span>
                                            </template>
                                        </td>
                                        <td class="whitespace-nowrap px-6 py-4 text-center text-sm font-medium">
                                            <template x-if="subscription.status === 'pending' && (subscription.is_paid === '0' || subscription.is_paid === 0)">
                                                <button
                                                    @click="markAsPaid(subscription.id)"
                                                    class="inline-flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-sm font-semibold text-white transition-all hover:bg-primary/90 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2"
                                                    x-text="$store.i18n.t('approve')"
                                                ></button>
                                            </template>
                                            <template x-if="subscription.status !== 'pending' || subscription.is_paid === '1' || subscription.is_paid === 1">
                                                <span class="text-gray-400 dark:text-gray-500">-</span>
                                            </template>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>

                    <!-- Empty State -->
                    <div id="tableEmptyState" class="flex flex-col items-center justify-center py-16" x-show="!isLoading && !hasSubscriptions()" x-cloak>
                        <div class="mb-4 flex h-20 w-20 items-center justify-center rounded-full bg-gray-100 dark:bg-gray-800">
                            <svg class="h-10 w-10 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <h3 class="mb-2 text-lg font-semibold text-gray-900 dark:text-white" x-text="$store.i18n.t('no_subscriptions_found')"></h3>
                        <p class="text-sm text-gray-500 dark:text-gray-400" x-text="$store.i18n.t('no_subscriptions_description') || 'No subscriptions match your filters'"></p>
                    </div>
                </div>

                <!-- Pagination -->
                <div
                    class="flex flex-wrap items-center justify-between gap-4 border-t border-gray-200 bg-gray-50 px-6 py-4 dark:border-gray-700 dark:bg-gray-800/50"
                    x-show="hasSubscriptions()"
                >
                    <div class="text-sm text-gray-700 dark:text-gray-300">
                        <span x-text="$store.i18n.t('showing')"></span>
                        <span class="font-semibold" x-text="subscriptions.from || 0"></span>
                        <span x-text="$store.i18n.t('to')"></span>
                        <span class="font-semibold" x-text="subscriptions.to || 0"></span>
                        <span x-text="$store.i18n.t('of')"></span>
                        <span class="font-semibold" x-text="subscriptions.total || 0"></span>
                        <span x-text="$store.i18n.t('results')"></span>
                    </div>
                    <div class="flex items-center gap-2">
                        <button
                            @click="prevPage()"
                            :disabled="subscriptions.current_page === 1"
                            class="inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 transition-all hover:bg-gray-50 hover:shadow-md disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"
                            x-text="$store.i18n.t('previous')"
                        ></button>
                        <span class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300" x-text="subscriptions.current_page + ' / ' + subscriptions.last_page"></span>
                        <button
                            @click="nextPage()"
                            :disabled="subscriptions.current_page === subscriptions.last_page"
                            class="inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 transition-all hover:bg-gray-50 hover:shadow-md disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"
                            x-text="$store.i18n.t('next')"
                        ></button>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
