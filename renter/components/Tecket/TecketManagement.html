<!DOCTYPE html>
<html :lang="$store.i18n.getLocale()" :dir="$store.i18n.getLocale() === 'ar' ? 'rtl' : 'ltr'">
    <head>
        <title x-text="$store.i18n.t('tickets')">Support Tickets Management</title>
        <style>
            .color-success {
                background-color: #d1fae5;
                color: #065f46;
            }
            .color-danger {
                background-color: #fee2e2;
                color: #991b1b;
            }
            .color-warning {
                background-color: #fef3c7;
                color: #92400e;
            }
            .color-primary {
                background-color: #dbeafe;
                color: #1e40af;
            }

            .dropdown-menu {
                position: absolute;
                z-index: 50;
                margin-top: 0.25rem;
                width: 100%;
                border-radius: 0.375rem;
                background-color: white;
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
                border: 1px solid #e5e7eb;
            }

            .dark .dropdown-menu {
                background-color: #1f2937;
                border-color: #374151;
            }

            .dropdown-item {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                width: 100%;
                padding: 0.5rem 1rem;
                text-align: left;
                border: none;
                background: none;
                cursor: pointer;
                transition: background-color 0.2s;
            }

            .dropdown-item:hover {
                background-color: #f3f4f6;
            }

            .dark .dropdown-item:hover {
                background-color: #374151;
            }

            .quick-reply-btn {
                transition: all 0.2s ease-in-out;
            }

            .quick-reply-btn:hover {
                transform: translateY(-1px);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
        </style>
    </head>
    <body class="p-6">
        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="fixed inset-0 z-50 flex hidden items-center justify-center bg-gray-900 bg-opacity-50 backdrop-blur-sm">
            <div class="flex flex-col items-center rounded-xl bg-white p-8 shadow-2xl dark:bg-gray-800">
                <div class="mb-4 h-16 w-16 animate-spin rounded-full border-4 border-primary/20 border-t-primary"></div>
                <p class="text-lg font-medium text-gray-700 dark:text-gray-300" x-text="$store.i18n.t('loading_data')"></p>
            </div>
        </div>

        <div x-data="supportTickets">
            <!-- Header Stats -->
            <div class="mb-5 grid grid-cols-1 gap-6 sm:grid-cols-2 xl:grid-cols-4">
                <div class="panel">
                    <div class="flex items-center justify-between">
                        <div class="font-semibold text-primary" x-text="$store.i18n.t('total_tickets')"></div>
                        <div class="rounded-full bg-primary/20 p-2">
                            <svg class="h-5 w-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="1.5"
                                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                                ></path>
                            </svg>
                        </div>
                    </div>
                    <div class="mt-5 text-2xl font-bold" x-text="statistics?.overview?.total_tickets || 0"></div>
                </div>

                <div class="panel">
                    <div class="flex items-center justify-between">
                        <div class="font-semibold text-success" x-text="$store.i18n.t('open_tickets')"></div>
                        <div class="rounded-full bg-success/20 p-2">
                            <svg class="h-5 w-5 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="1.5"
                                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                                ></path>
                            </svg>
                        </div>
                    </div>
                    <div class="mt-5 text-2xl font-bold" x-text="statistics?.overview?.open_tickets || 0"></div>
                </div>

                <div class="panel">
                    <div class="flex items-center justify-between">
                        <div class="font-semibold text-warning" x-text="$store.i18n.t('in_progress_tickets')"></div>
                        <div class="rounded-full bg-warning/20 p-2">
                            <svg class="h-5 w-5 text-warning" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="mt-5 text-2xl font-bold" x-text="statistics?.overview?.in_progress_tickets || 0"></div>
                </div>

                <div class="panel">
                    <div class="flex items-center justify-between">
                        <div class="font-semibold text-danger" x-text="$store.i18n.t('closed_tickets')"></div>
                        <div class="rounded-full bg-danger/20 p-2">
                            <svg class="h-5 w-5 text-danger" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="1.5"
                                    d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"
                                ></path>
                            </svg>
                        </div>
                    </div>
                    <div class="mt-5 text-2xl font-bold" x-text="statistics?.overview?.closed_tickets || 0"></div>
                </div>
            </div>

            <div class="relative flex h-full gap-5 sm:h-[calc(100vh_-_150px)] sm:min-h-0" :class="{'min-h-[999px]' : isShowTicketMenu}">
                <!-- Tickets List Panel -->
                <div
                    class="panel absolute z-10 hidden w-full max-w-xs flex-none space-y-4 overflow-hidden p-4 xl:relative xl:block xl:h-full"
                    :class="isShowTicketMenu && '!block'"
                >
                    <!-- Search and Filters -->
                    <div class="space-y-4">
                        <div class="relative">
                            <input
                                type="text"
                                class="peer form-input ltr:pr-9 rtl:pl-9"
                                :placeholder="$store.i18n.t('search_tickets')"
                                x-model="searchTicket"
                            />
                            <div class="absolute top-1/2 -translate-y-1/2 peer-focus:text-primary ltr:right-2 rtl:left-2">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="11.5" cy="11.5" r="9.5" stroke="currentColor" stroke-width="1.5" opacity="0.5"></circle>
                                    <path d="M18.5 18.5L22 22" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path>
                                </svg>
                            </div>
                        </div>

                        <!-- Filters -->
                        <div class="flex flex-wrap gap-2">
                            <select class="form-select flex-1" x-model="statusFilter">
                                <option value="" x-text="$store.i18n.t('all_statuses')"></option>
                                <option value="open" x-text="$store.i18n.t('open')"></option>
                                <option value="in_progress" x-text="$store.i18n.t('in_progress')"></option>
                                <option value="resolved" x-text="$store.i18n.t('resolved')"></option>
                                <option value="closed" x-text="$store.i18n.t('closed')"></option>
                            </select>

                            <select class="form-select flex-1" x-model="priorityFilter">
                                <option value="" x-text="$store.i18n.t('all_priorities')"></option>
                                <option value="low" x-text="$store.i18n.t('low')"></option>
                                <option value="medium" x-text="$store.i18n.t('medium')"></option>
                                <option value="high" x-text="$store.i18n.t('high')"></option>
                                <option value="urgent" x-text="$store.i18n.t('urgent')"></option>
                            </select>
                        </div>
                    </div>

                    <div class="h-px w-full border-b border-[#e0e6ed] dark:border-[#1b2e4b]"></div>

                    <!-- Tickets List -->
                    <div class="!mt-0">
                        <div
                            class="tickets-list perfect-scrollbar relative h-full min-h-[100px] space-y-0.5 overflow-y-auto pr-3.5"
                            style="max-height: calc(100vh - 200px)"
                        >
                            <template x-for="ticket in filteredTickets()" :key="ticket.id">
                                <button
                                    type="button"
                                    class="flex w-full items-center justify-between rounded-md p-4 hover:bg-gray-100 hover:text-primary dark:hover:bg-[#050b14] dark:hover:text-primary"
                                    :class="{'bg-gray-100 dark:bg-[#050b14] dark:text-primary text-primary': selectedTicket && selectedTicket.id === ticket.id}"
                                    @click="selectTicket(ticket)"
                                >
                                    <div class="flex-1">
                                        <div class="flex items-start space-x-3">
                                            <div class="flex-shrink-0">
                                                <div
                                                    class="h-3 w-3 rounded-full"
                                                    :class="{
                                                        'bg-success': ticket.status === 'open',
                                                        'bg-warning': ticket.status === 'in_progress',
                                                        'bg-primary': ticket.status === 'resolved',
                                                        'bg-danger': ticket.status === 'closed'
                                                    }"
                                                ></div>
                                            </div>
                                            <div class="flex-1 ltr:text-left rtl:text-right">
                                                <p class="mb-1 font-semibold" x-text="ticket.ticket_number"></p>
                                                <p class="mb-1 text-sm font-medium" x-text="ticket.subject"></p>
                                                <p class="max-w-[185px] truncate text-xs text-white-dark" x-text="ticket.user?.name || 'Unknown User'"></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="whitespace-nowrap text-xs font-semibold">
                                        <div
                                            class="mb-1 rounded-full px-2 py-1 text-xs capitalize"
                                            :class="{
                                                'bg-success/20 text-success': ticket.priority === 'low',
                                                'bg-primary/20 text-primary': ticket.priority === 'medium',
                                                'bg-warning/20 text-warning': ticket.priority === 'high',
                                                'bg-danger/20 text-danger': ticket.priority === 'urgent'
                                            }"
                                            x-text="getPriorityLabel(ticket.priority)"
                                        ></div>
                                        <p x-text="formatTime(ticket.created_at)"></p>
                                        <div x-show="ticket.chat_count > 0" class="mt-1 flex justify-end">
                                            <span
                                                class="flex h-5 w-5 items-center justify-center rounded-full bg-primary text-xs text-white"
                                                x-text="ticket.chat_count"
                                            ></span>
                                        </div>
                                    </div>
                                </button>
                            </template>

                            <template x-if="filteredTickets().length === 0">
                                <div class="flex h-full items-center justify-center p-4">
                                    <div class="text-center text-gray-500 dark:text-gray-400">
                                        <svg class="mx-auto mb-3 h-12 w-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="1"
                                                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                                            ></path>
                                        </svg>
                                        <p x-text="$store.i18n.t('no_tickets_found')"></p>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- Overlay for mobile -->
                <div
                    class="absolute z-[5] hidden h-full w-full rounded-md bg-black/60"
                    :class="isShowTicketMenu && '!block xl:!hidden'"
                    @click="isShowTicketMenu = !isShowTicketMenu"
                ></div>

                <!-- Ticket Details Panel -->
                <div class="panel flex-1 p-0">
                    <template x-if="!isShowTicketDetail">
                        <div class="relative flex h-full items-center justify-center p-4">
                            <button
                                type="button"
                                class="absolute top-4 hover:text-primary xl:hidden ltr:left-4 rtl:right-4"
                                @click="isShowTicketMenu = !isShowTicketMenu"
                            >
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6">
                                    <path d="M20 7L4 7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                    <path opacity="0.5" d="M20 12L4 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                    <path d="M20 17L4 17" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                </svg>
                            </button>

                            <div class="flex flex-col items-center justify-center py-8">
                                <div class="mb-8 h-[calc(100vh_-_320px)] min-h-[120px] w-[280px] text-white dark:text-[#0e1726] md:w-[430px]">
                                    <!-- SVG Illustration -->
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-full w-full">
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="1"
                                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                                        ></path>
                                    </svg>
                                </div>
                                <p class="mx-auto flex max-w-[190px] justify-center rounded-md bg-white-dark/20 p-2 font-semibold">
                                    <svg
                                        width="24"
                                        height="24"
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        xmlns="http://www.w3.org/2000/svg"
                                        class="h-5 w-5 ltr:mr-2 rtl:ml-2"
                                    >
                                        <path
                                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                                        ></path>
                                    </svg>
                                    <span x-text="$store.i18n.t('select_ticket')"></span>
                                </p>
                            </div>
                        </div>
                    </template>

                    <template x-if="isShowTicketDetail && selectedTicket">
                        <div class="relative h-full">
                            <!-- Ticket Header - محسن -->
                            <div class="flex flex-col justify-between gap-4 p-4 sm:flex-row sm:items-center">
                                <div class="flex items-center space-x-3 rtl:space-x-reverse">
                                    <button type="button" class="hover:text-primary xl:hidden" @click="isShowTicketMenu = !isShowTicketMenu">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6">
                                            <path d="M20 7L4 7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                            <path opacity="0.5" d="M20 12L4 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                            <path d="M20 17L4 17" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                        </svg>
                                    </button>
                                    <div>
                                        <div class="flex items-center space-x-3">
                                            <p class="text-lg font-semibold" x-text="selectedTicket.ticket_number"></p>
                                            <span
                                                class="rounded-full px-2 py-1 text-xs font-medium"
                                                :class="getStatusBadgeClass(selectedTicket.status)"
                                                x-text="getStatusLabel(selectedTicket.status)"
                                            ></span>
                                        </div>
                                        <p class="text-sm text-gray-600 dark:text-gray-400" x-text="selectedTicket.subject"></p>
                                    </div>
                                </div>

                                <!-- Ticket Actions - محسن -->
                                <div class="flex flex-wrap items-center gap-2">
                                    <!-- Status Dropdown -->
                                    <div class="dropdown" x-data="{ open: false }" @click.outside="open = false">
                                        <button type="button" class="btn btn-outline-primary btn-sm flex items-center space-x-1" @click="open = !open">
                                            <span x-text="$store.i18n.t('status') + ':'"></span>
                                            <span class="font-medium" x-text="getStatusLabel(selectedTicket.status)"></span>
                                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                            </svg>
                                        </button>
                                        <div x-show="open" class="dropdown-menu" style="min-width: 160px">
                                            <button type="button" class="dropdown-item" @click="updateStatus('open'); open = false">
                                                <div class="h-2 w-2 rounded-full bg-success"></div>
                                                <span x-text="$store.i18n.t('open')"></span>
                                            </button>
                                            <button type="button" class="dropdown-item" @click="updateStatus('in_progress'); open = false">
                                                <div class="h-2 w-2 rounded-full bg-warning"></div>
                                                <span x-text="$store.i18n.t('in_progress')"></span>
                                            </button>
                                            <button type="button" class="dropdown-item" @click="updateStatus('resolved'); open = false">
                                                <div class="h-2 w-2 rounded-full bg-primary"></div>
                                                <span x-text="$store.i18n.t('resolved')"></span>
                                            </button>
                                            <button type="button" class="dropdown-item" @click="updateStatus('closed'); open = false">
                                                <div class="h-2 w-2 rounded-full bg-danger"></div>
                                                <span x-text="$store.i18n.t('closed')"></span>
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Priority Dropdown -->
                                    <div class="dropdown" x-data="{ open: false }" @click.outside="open = false">
                                        <button type="button" class="btn btn-outline-primary btn-sm flex items-center space-x-1" @click="open = !open">
                                            <span x-text="$store.i18n.t('priority') + ':'"></span>
                                            <span class="font-medium capitalize" x-text="getPriorityLabel(selectedTicket.priority)"></span>
                                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                            </svg>
                                        </button>
                                        <div x-show="open" class="dropdown-menu" style="min-width: 160px">
                                            <button type="button" class="dropdown-item" @click="updatePriority('low'); open = false">
                                                <div class="h-2 w-2 rounded-full bg-success"></div>
                                                <span x-text="$store.i18n.t('low')"></span>
                                            </button>
                                            <button type="button" class="dropdown-item" @click="updatePriority('medium'); open = false">
                                                <div class="h-2 w-2 rounded-full bg-primary"></div>
                                                <span x-text="$store.i18n.t('medium')"></span>
                                            </button>
                                            <button type="button" class="dropdown-item" @click="updatePriority('high'); open = false">
                                                <div class="h-2 w-2 rounded-full bg-warning"></div>
                                                <span x-text="$store.i18n.t('high')"></span>
                                            </button>
                                            <button type="button" class="dropdown-item" @click="updatePriority('urgent'); open = false">
                                                <div class="h-2 w-2 rounded-full bg-danger"></div>
                                                <span x-text="$store.i18n.t('urgent')"></span>
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Action Buttons -->
                                    <button type="button" class="btn btn-warning btn-sm flex items-center space-x-1" @click="addInternalNote()">
                                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
                                            ></path>
                                        </svg>
                                        <span x-text="$store.i18n.t('internal_note')"></span>
                                    </button>

                                    <button
                                        type="button"
                                        class="btn btn-danger btn-sm flex items-center space-x-1"
                                        @click="selectedTicket.status === 'closed' ? reopenTicket() : closeTicket()"
                                    >
                                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                        </svg>
                                        <span
                                            x-text="selectedTicket.status === 'closed' ? 
                                               $store.i18n.t('reopen_ticket') : 
                                               $store.i18n.t('close_ticket')"
                                        ></span>
                                    </button>
                                </div>
                            </div>

                            <div class="h-px w-full border-b border-[#e0e6ed] dark:border-[#1b2e4b]"></div>

                            <!-- Ticket Content -->
                            <div class="perfect-scrollbar relative h-full overflow-y-auto" style="max-height: calc(100vh - 350px)">
                                <div class="ticket-conversation-box min-h-[400px] space-y-5 p-4 pb-[68px] sm:min-h-[300px] sm:pb-0">
                                    <!-- Ticket Info -->
                                    <div class="rounded-lg bg-gray-50 p-4 dark:bg-gray-800">
                                        <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
                                            <div>
                                                <p class="text-sm font-medium text-gray-500" x-text="$store.i18n.t('user')"></p>
                                                <p class="font-semibold" x-text="selectedTicket.user?.name || 'Unknown'"></p>
                                                <p class="text-sm text-gray-600" x-text="selectedTicket.user?.email"></p>
                                            </div>
                                            <div>
                                                <p class="text-sm font-medium text-gray-500" x-text="$store.i18n.t('category')"></p>
                                                <p class="font-semibold" x-text="selectedTicket.category"></p>
                                            </div>
                                            <div>
                                                <p class="text-sm font-medium text-gray-500" x-text="$store.i18n.t('created_at')"></p>
                                                <p class="font-semibold" x-text="formatTime(selectedTicket.created_at)"></p>
                                            </div>
                                            <div>
                                                <p class="text-sm font-medium text-gray-500" x-text="$store.i18n.t('last_activity')"></p>
                                                <p class="font-semibold" x-text="formatTime(selectedTicket.updated_at)"></p>
                                            </div>
                                        </div>
                                        <div class="mt-4">
                                            <p class="text-sm font-medium text-gray-500" x-text="$store.i18n.t('description')"></p>
                                            <p class="mt-1 whitespace-pre-wrap" x-text="selectedTicket.description"></p>
                                        </div>
                                    </div>

                                    <!-- Conversation -->
                                    <template x-if="selectedTicket && Array.isArray(selectedTicket.chats) && selectedTicket.chats.length > 0">
                                        <template x-for="message in selectedTicket.chats" :key="message.id">
                                            <div class="flex items-start gap-3" :class="{'justify-end' : message.sender_id === loginUser.id}">
                                                <div class="max-w-[70%] space-y-2">
                                                    <div class="flex items-center gap-3" :class="{'flex-row-reverse' : message.sender_id === loginUser.id}">
                                                        <div
                                                            class="break-words rounded-md p-4 py-2"
                                                            :class="message.sender_id === loginUser.id 
                                                                ? 'ltr:rounded-br-none rtl:rounded-bl-none !bg-primary text-white' 
                                                                : message.is_internal_note
                                                                    ? 'ltr:rounded-bl-none rtl:rounded-br-none bg-black/10 dark:bg-gray-800 text-red-600'
                                                                    : 'ltr:rounded-bl-none rtl:rounded-br-none bg-black/10 dark:bg-gray-800'"
                                                            x-text="message.message"
                                                        ></div>
                                                    </div>
                                                    <div class="flex items-center justify-between text-xs text-white-dark">
                                                        <span x-text="message.sender?.name"></span>
                                                        <span x-text="formatTime(message.created_at)"></span>
                                                    </div>
                                                    <template x-if="message.is_internal_note">
                                                        <div class="text-xs text-warning" x-text="$store.i18n.t('internal_notes')"></div>
                                                    </template>
                                                </div>
                                            </div>
                                        </template>
                                    </template>

                                    <!-- No Messages -->
                                    <template x-if="selectedTicket && (!selectedTicket.chats || selectedTicket.chats.length === 0)">
                                        <div class="flex h-full items-center justify-center py-8">
                                            <div class="text-center text-gray-500 dark:text-gray-400">
                                                <p x-text="$store.i18n.t('no_messages')"></p>
                                                <p class="text-sm" x-text="$store.i18n.t('start_conversation')"></p>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>

                            <!-- Reply Section - محسن -->
                            <div class="absolute bottom-0 left-0 w-full border-t border-[#e0e6ed] bg-white p-4 dark:border-[#1b2e4b] dark:bg-[#0e1726]">
                                <div class="flex flex-col space-y-3 sm:flex-row sm:items-center sm:space-x-3 sm:space-y-0 rtl:sm:space-x-reverse">
                                    <div class="relative flex-1">
                                        <input
                                            class="form-input rounded-full border-0 bg-[#f4f4f4] px-12 py-3 focus:outline-none dark:bg-gray-800"
                                            :placeholder="$store.i18n.t('type_message')"
                                            x-model="replyMessage"
                                            @keyup.enter="sendReply()"
                                        />
                                        <button type="button" class="absolute top-1/2 -translate-y-1/2 hover:text-primary ltr:left-4 rtl:right-4">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <circle opacity="0.5" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" />
                                                <path
                                                    d="M9 16C9.85038 16.6303 10.8846 17 12 17C13.1154 17 14.1496 16.6303 15 16"
                                                    stroke="currentColor"
                                                    stroke-width="1.5"
                                                    stroke-linecap="round"
                                                />
                                                <path
                                                    d="M16 10.5C16 11.3284 15.5523 12 15 12C14.4477 12 14 11.3284 14 10.5C14 9.67157 14.4477 9 15 9C15.5523 9 16 9.67157 16 10.5Z"
                                                    fill="currentColor"
                                                />
                                                <ellipse cx="9" cy="10.5" rx="1" ry="1.5" fill="currentColor" />
                                            </svg>
                                        </button>
                                        <button
                                            type="button"
                                            class="absolute top-1/2 -translate-y-1/2 hover:text-primary ltr:right-4 rtl:left-4"
                                            @click="sendReply()"
                                        >
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path
                                                    d="M17.4975 18.4851L20.6281 9.09373C21.8764 5.34874 22.5006 3.47624 21.5122 2.48782C20.5237 1.49939 18.6511 2.12356 14.906 3.37189L5.57477 6.48218C3.49295 7.1761 2.45203 7.52305 2.13608 8.28637C2.06182 8.46577 2.01692 8.65596 2.00311 8.84963C1.94433 9.67365 2.72018 10.4495 4.27188 12.0011L4.55451 12.2837C4.80921 12.5384 4.93655 12.6658 5.03282 12.8075C5.22269 13.0871 5.33046 13.4143 5.34393 13.7519C5.35076 13.9232 5.32403 14.1013 5.27057 14.4574C5.07488 15.7612 4.97703 16.4131 5.0923 16.9147C5.32205 17.9146 6.09599 18.6995 7.09257 18.9433C7.59255 19.0656 8.24576 18.977 9.5522 18.7997L9.62363 18.79C9.99191 18.74 10.1761 18.715 10.3529 18.7257C10.6738 18.745 10.9838 18.8496 11.251 19.0285C11.3981 19.1271 11.5295 19.2585 11.7923 19.5213L12.0436 19.7725C13.5539 21.2828 14.309 22.0379 15.1101 21.9985C15.3309 21.9877 15.5479 21.9365 15.7503 21.8474C16.4844 21.5244 16.8221 20.5113 17.4975 18.4851Z"
                                                    stroke="currentColor"
                                                    stroke-width="1.5"
                                                />
                                                <path opacity="0.5" d="M6 18L21 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                            </svg>
                                        </button>
                                    </div>

                                    <div class="flex items-center space-x-2 rtl:space-x-reverse">
                                        <button type="button" class="btn btn-outline-warning btn-sm flex items-center space-x-1" @click="addInternalNote()">
                                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
                                                ></path>
                                            </svg>
                                            <span x-text="$store.i18n.t('internal_note')"></span>
                                        </button>

                                        <button
                                            type="button"
                                            class="btn btn-outline-danger btn-sm flex items-center space-x-1"
                                            @click="selectedTicket.status === 'closed' ? reopenTicket() : closeTicket()"
                                        >
                                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                            <span
                                                x-text="selectedTicket.status === 'closed' ? 
                                                   $store.i18n.t('reopen_ticket') : 
                                                   $store.i18n.t('close_ticket')"
                                            ></span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Quick Actions -->
                                <div class="mt-3 flex flex-wrap gap-2">
                                    <template x-for="quickReply in quickReplies" :key="quickReply.id">
                                        <button
                                            type="button"
                                            class="quick-reply-btn rounded-full bg-gray-100 px-3 py-1 text-xs hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600"
                                            @click="replyMessage = quickReply.text"
                                            x-text="quickReply.label"
                                        ></button>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </body>
</html>
